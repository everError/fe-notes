### 모듈 로딩 시점과 초기화 시점 이해하기

**모듈 로딩 시점**과 **애플리케이션 초기화 시점**을 혼동하면 예상치 못한 버그를 마주하게 됩니다. `import` 문으로 모듈을 가져오는 순간, 해당 모듈의 코드가 즉시 실행됩니다. 이때 **`export const`로 선언된 변수도 함께 실행**됩니다. 그러나 대부분의 프레임워크는 애플리케이션이 시작될 때 플러그인을 설정하거나 데이터를 가져오는 등의 초기화 작업을 수행합니다.

이로 인해, 초기화가 완료되기 전에 모듈 최상단에서 의존성을 사용하는 코드를 작성하면 오류가 발생합니다.

---

### 올바른 코드 작성 원칙

개발 편의성을 추구하더라도 코드가 어떻게 동작하는지에 대한 정확한 이해를 바탕으로 해야 합니다. 단순히 한두 줄을 줄이기 위해 작성한 코드가 더 큰 문제를 초래할 수 있으므로, **언제 코드가 실행되는지** 항상 명확히 이해하고 설계해야 합니다.

- **라이프사이클에 맞춰 코드를 작성하세요.** 외부 의존성이 있는 코드는 해당 의존성이 준비되는 시점(예: 컴포넌트의 `setup()` 또는 `onMounted()`)에 실행되어야 합니다.
- **프레임워크가 제공하는 공식 훅을 활용하세요.** 프레임워크가 제공하는 공식적인 패턴은 내부적으로 초기화 시점을 보장하므로, 안전하게 사용할 수 있습니다.
- **책임의 분리 원칙을 지키세요.** 모듈 상단은 의존성을 가져오는 역할에 집중하고, 특정 기능의 실행은 해당 기능이 필요한 컴포넌트나 함수 내부에서 처리해야 합니다.

---

### 보편적인 개발 상황에서의 예시

다음은 모듈 로딩 시점과 초기화 시점을 혼동해서 발생하는 대표적인 오류 사례들입니다.

**1. `vue-i18n`의 `t` 함수**
`main.js`에서 `vue-i18n`을 초기화하기 전에 다른 모듈에서 번역 함수 `t`를 사용하려 할 때 발생하는 문제입니다.

**잘못된 예시**

```javascript
// i18n 인스턴스가 초기화되기도 전에 t에 접근하여 오류가 발생합니다.
import { i18n } from './main';
export const t = i18n.global.t as (key: string, ...args: any[]) => string;
```

**올바른 예시**

```javascript
// 컴포넌트 라이프사이클 안에서 훅을 사용하여 안전하게 t를 가져옵니다.
import { useI18n } from "vue-i18n";
// ...
const { t } = useI18n();
```

**2. API 클라이언트 인스턴스**
API 통신을 위한 환경 변수나 토큰이 `main.js`에서 설정되는데, 다른 모듈에서 이 설정을 사용하려 할 때 아직 설정이 완료되지 않아 오류가 발생할 수 있습니다.

**잘못된 예시**

```javascript
// config.js
// API_KEY가 아직 설정되지 않은 상태일 수 있습니다.
export const api = new ApiClient({ apiKey: process.env.API_KEY });
```

**올바른 예시**

```javascript
// api.js
// 함수 호출 시점에 필요한 설정을 가져와 사용합니다.
export const fetchUserData = (userId) => {
  const apiKey = process.env.API_KEY;
  const api = new ApiClient({ apiKey });
  return api.get(`/users/${userId}`);
};
```
